# InfraAsCode

## Prérequis

- macOS ou Linux
- [OpenTofu](https://opentofu.org/docs/intro/install/) installé (`brew install opentofu`)
- [Ansible](https://docs.ansible.com/) installé (`pip3 install ansible`)
- [Docker CLI](https://docs.docker.com/engine/install/) installé (`brew install docker`)
- Un compte OVH avec accès à un projet OpenStack
- Un fichier `openrc-etudiant.sh` fourni par OVH (non versionné)
- Une paire de clés SSH dans `~/.ssh/id_rsa` / `~/.ssh/id_rsa.pub`
  - Si absente : `ssh-keygen -t rsa -b 4096 -f ~/.ssh/id_rsa -N ""`

---

## Getting Started

### 1. Cloner le projet
```bash
git clone https://github.com/hawkk47/InfraAsCode.git
cd InfraAsCode
```

### 2. Créer l'environnement Python
```bash
python3 -m venv .venv
source .venv/bin/activate
pip install ansible
ansible-galaxy collection install community.docker
```

### 3. Charger les credentials OpenStack
```bash
source openrc-etudiant.sh
```

### 4. Provisionner l'infrastructure
```bash
tofu init
tofu apply
```

### 5. Générer l'inventaire et configurer la VM
```bash
bash inventory.sh
ansible-playbook -i inventory.ini playbook.yml
```

### 6. Déployer les stacks Docker
```bash
export DOCKER_HOST=ssh://ubuntu@$(tofu output -raw instance_ip)
docker stack deploy -c stacks/traefik.yml traefik
docker stack deploy -c stacks/whoami.yml whoami
```

### 7. Détruire l'infrastructure
```bash
tofu destroy
```